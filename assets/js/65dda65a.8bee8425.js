"use strict";(self.webpackChunkuniversity=self.webpackChunkuniversity||[]).push([[827],{9479:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>d,default:()=>h,frontMatter:()=>s,metadata:()=>a,toc:()=>r});var l=t(4848),i=t(8453);const s={title:"JSON Templating"},d=void 0,a={id:"learn/json-templating/index",title:"JSON Templating",description:"JSON Templating engine is commonly used to configure many of our extensions.",source:"@site/docs/learn/json-templating/index.md",sourceDirName:"learn/json-templating",slug:"/learn/json-templating/",permalink:"/docs/learn/json-templating/",draft:!1,unlisted:!1,editUrl:"https://github.com/rossumai/university/tree/master/docs/learn/json-templating/index.md",tags:[],version:"current",frontMatter:{title:"JSON Templating"},sidebar:"learnSidebar",previous:{title:"Configuration examples",permalink:"/docs/learn/find-replace-values/configuration-examples"},next:{title:"Line items grouping",permalink:"/docs/learn/line-items-grouping/"}},c={},r=[{value:"JSON Templating Syntax",id:"json-templating-syntax",level:2},{value:"JSON Templating Operators",id:"json-templating-operators",level:2},{value:"<code>$DATAPOINT_MAPPING$</code>",id:"datapoint_mapping",level:3},{value:"Example",id:"example",level:4},{value:"Available configuration options",id:"available-configuration-options",level:4},{value:"<code>$DATAPOINT_VALUE$</code>",id:"datapoint_value",level:3},{value:"Available configuration options",id:"available-configuration-options-1",level:4},{value:"<code>$FOR_EACH_SCHEMA_ID$</code>",id:"for_each_schema_id",level:3},{value:"Example",id:"example-1",level:4},{value:"Available configuration options",id:"available-configuration-options-2",level:4},{value:"<code>$IF_DATAPOINT_VALUE$</code>",id:"if_datapoint_value",level:3},{value:"Example",id:"example-2",level:4},{value:"Available configuration options",id:"available-configuration-options-3",level:4},{value:"<code>$IF_SCHEMA_ID$</code>",id:"if_schema_id",level:3},{value:"Example",id:"example-3",level:4},{value:"Available configuration options",id:"available-configuration-options-4",level:4}];function o(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.p,{children:"JSON Templating engine is commonly used to configure many of our extensions."}),"\n",(0,l.jsx)(n.h2,{id:"json-templating-syntax",children:"JSON Templating Syntax"}),"\n",(0,l.jsx)(n.p,{children:"The basic and most commonly used syntax is for getting values from the annotation object:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json",children:'{\n  "some_field": "@{schema_id_of_datapoint}"\n}\n'})}),"\n",(0,l.jsxs)(n.p,{children:["See also ",(0,l.jsx)(n.a,{href:"#datapoint_value",children:(0,l.jsx)(n.code,{children:"$DATAPOINT_VALUE$"})})," for more verbose syntax."]}),"\n",(0,l.jsx)(n.h2,{id:"json-templating-operators",children:"JSON Templating Operators"}),"\n",(0,l.jsx)(n.p,{children:"Operators are a special syntax that can be used to perform various complex operations when working with JSON."}),"\n",(0,l.jsx)(n.h3,{id:"datapoint_mapping",children:(0,l.jsx)(n.code,{children:"$DATAPOINT_MAPPING$"})}),"\n",(0,l.jsxs)(n.p,{children:["Returns rendered template specified in ",(0,l.jsx)(n.code,{children:"mapping"})," for certain value of ",(0,l.jsx)(n.code,{children:"schema_id"}),"."]}),"\n",(0,l.jsx)(n.h4,{id:"example",children:"Example"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json",children:'{\n  "_ns_type": {\n    "$DATAPOINT_MAPPING$": {\n      "schema_id": "document_type",\n      "mapping": {\n        "tax_credit": "VendorCredit",\n        "tax_invoice": "VendorBill"\n      },\n      "fallback_mapping": "Vendor" // optional\n    }\n  }\n}\n'})}),"\n",(0,l.jsxs)(n.p,{children:["This template will return the following for ",(0,l.jsx)(n.code,{children:"document_type"})," with value ",(0,l.jsx)(n.code,{children:"tax_credit"}),":"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json",children:'{ "_ns_type": "VendorCredit" }\n'})}),"\n",(0,l.jsxs)(n.p,{children:["Similarly, this template will return the following for ",(0,l.jsx)(n.code,{children:"tax_invoice"})," value:"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json",children:'{ "_ns_type": "VendorBill" }\n'})}),"\n",(0,l.jsxs)(n.p,{children:["Finally, the template will return the ",(0,l.jsx)(n.code,{children:"_ns_type"})," of ",(0,l.jsx)(n.code,{children:"Vendor"})," if no other value is found. This value can be omitted which will default to ",(0,l.jsx)(n.code,{children:"null"}),"."]}),"\n",(0,l.jsx)(n.h4,{id:"available-configuration-options",children:"Available configuration options"}),"\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{style:{textAlign:"left"},children:"Configuration option"}),(0,l.jsx)(n.th,{style:{textAlign:"left"},children:"Description"}),(0,l.jsx)(n.th,{style:{textAlign:"left"},children:"Required"}),(0,l.jsx)(n.th,{style:{textAlign:"left"},children:"Default"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{style:{textAlign:"left"},children:(0,l.jsx)(n.code,{children:"schema_id"})}),(0,l.jsx)(n.td,{style:{textAlign:"left"},children:"Schema ID of the datapoint."}),(0,l.jsx)(n.td,{style:{textAlign:"left"},children:"YES"}),(0,l.jsx)(n.td,{style:{textAlign:"left"}})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{style:{textAlign:"left"},children:(0,l.jsx)(n.code,{children:"mapping"})}),(0,l.jsxs)(n.td,{style:{textAlign:"left"},children:["Mapping of the datapoint value (",(0,l.jsx)(n.code,{children:"schema_id"}),")."]}),(0,l.jsx)(n.td,{style:{textAlign:"left"},children:"YES"}),(0,l.jsx)(n.td,{style:{textAlign:"left"}})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{style:{textAlign:"left"},children:(0,l.jsx)(n.code,{children:"fallback_mapping"})}),(0,l.jsx)(n.td,{style:{textAlign:"left"},children:"Default template that will be used if template for found datapoint value is not provided in the mapping."}),(0,l.jsx)(n.td,{style:{textAlign:"left"},children:"no"}),(0,l.jsx)(n.td,{style:{textAlign:"left"},children:(0,l.jsx)(n.code,{children:"null"})})]})]})]}),"\n",(0,l.jsx)(n.h3,{id:"datapoint_value",children:(0,l.jsx)(n.code,{children:"$DATAPOINT_VALUE$"})}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:"$DATAPOINT_VALUE$"})," is a more verbose syntax for ",(0,l.jsx)(n.code,{children:"@{schema_id}"}),". In other words, the following examples are identical:"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json",children:'{\n  "externalId": "@{ns_external_id_generated}"\n}\n'})}),"\n",(0,l.jsx)(n.p,{children:"Identical to:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json",children:'{\n  "externalId": {\n    "$DATAPOINT_VALUE$": {\n      "schema_id": "ns_external_id_generated",\n      "value_type": "string"\n    }\n  }\n}\n'})}),"\n",(0,l.jsx)(n.p,{children:"While the latter might seem unnecessary, it is needed when we want to cast the value to a certain type. For example:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json",children:'{\n  "tranDate": {\n    "$DATAPOINT_VALUE$": {\n      "schema_id": "date_issue",\n      "value_type": "iso_datetime"\n    }\n  }\n}\n'})}),"\n",(0,l.jsx)(n.h4,{id:"available-configuration-options-1",children:"Available configuration options"}),"\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{style:{textAlign:"left"},children:"Configuration option"}),(0,l.jsx)(n.th,{style:{textAlign:"left"},children:"Description"}),(0,l.jsx)(n.th,{style:{textAlign:"left"},children:"Required"}),(0,l.jsx)(n.th,{style:{textAlign:"left"},children:"Default"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{style:{textAlign:"left"},children:(0,l.jsx)(n.code,{children:"schema_id"})}),(0,l.jsx)(n.td,{style:{textAlign:"left"},children:"Schema ID of the datapoint."}),(0,l.jsx)(n.td,{style:{textAlign:"left"},children:"YES"}),(0,l.jsx)(n.td,{style:{textAlign:"left"}})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{style:{textAlign:"left"},children:(0,l.jsx)(n.code,{children:"value_type"})}),(0,l.jsxs)(n.td,{style:{textAlign:"left"},children:["Type to which the value should be converted. Supported types are: ",(0,l.jsx)(n.code,{children:"string"}),", ",(0,l.jsx)(n.code,{children:"integer"}),", ",(0,l.jsx)(n.code,{children:"float"}),", ",(0,l.jsx)(n.code,{children:"boolean"}),", and ",(0,l.jsx)(n.code,{children:"iso_datetime"}),"."]}),(0,l.jsx)(n.td,{style:{textAlign:"left"},children:"no"}),(0,l.jsx)(n.td,{style:{textAlign:"left"},children:(0,l.jsx)(n.code,{children:"string"})})]})]})]}),"\n",(0,l.jsx)(n.h3,{id:"for_each_schema_id",children:(0,l.jsx)(n.code,{children:"$FOR_EACH_SCHEMA_ID$"})}),"\n",(0,l.jsx)(n.p,{children:"Iterates over multiline schema IDs, typically line items."}),"\n",(0,l.jsx)(n.h4,{id:"example-1",children:"Example"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json",children:'{\n  "items": {\n    "$FOR_EACH_SCHEMA_ID$": {\n      "schema_id": "line_item",\n      "mapping": {\n        "_ns_type": "VendorBillItem",\n        "quantity": "@{item_quantity}",\n        "description": "@{item_description}"\n      }\n    }\n  }\n}\n'})}),"\n",(0,l.jsx)(n.p,{children:"Will render:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json",children:'{\n  "items": [\n    {\n      "_ns_type": "VendorBillItem",\n      "quantity": "1",\n      "description": "Some description 1"\n    },\n    {\n      "_ns_type": "VendorBillItem",\n      "quantity": "2",\n      "description": "Some description 2"\n    }\n    // \u2026\n  ]\n}\n'})}),"\n",(0,l.jsxs)(n.p,{children:["Inside the for-loop block, you can access a special variables (",(0,l.jsx)(n.code,{children:"schema_loop"}),"):"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"schema_loop.index"})," for current iteration of the loop indexed from 1"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"schema_loop.index0"})," for current iteration of the loop indexed from 0"]}),"\n"]}),"\n",(0,l.jsx)(n.h4,{id:"available-configuration-options-2",children:"Available configuration options"}),"\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{style:{textAlign:"left"},children:"Configuration option"}),(0,l.jsx)(n.th,{style:{textAlign:"left"},children:"Description"}),(0,l.jsx)(n.th,{style:{textAlign:"left"},children:"Required"}),(0,l.jsx)(n.th,{style:{textAlign:"left"},children:"Default"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{style:{textAlign:"left"},children:(0,l.jsx)(n.code,{children:"schema_id"})}),(0,l.jsx)(n.td,{style:{textAlign:"left"},children:"Schema ID of the datapoint."}),(0,l.jsx)(n.td,{style:{textAlign:"left"},children:"YES"}),(0,l.jsx)(n.td,{style:{textAlign:"left"}})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{style:{textAlign:"left"},children:(0,l.jsx)(n.code,{children:"mapping"})}),(0,l.jsxs)(n.td,{style:{textAlign:"left"},children:["Mapping template that will be rendered for each element found with the given ",(0,l.jsx)(n.code,{children:"schema_id"}),"."]}),(0,l.jsx)(n.td,{style:{textAlign:"left"},children:"YES"}),(0,l.jsx)(n.td,{style:{textAlign:"left"}})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{style:{textAlign:"left"},children:(0,l.jsx)(n.code,{children:"fallback_mapping"})}),(0,l.jsxs)(n.td,{style:{textAlign:"left"},children:["Mapping template that will be rendered if no element with the given ",(0,l.jsx)(n.code,{children:"schema_id"})," is found."]}),(0,l.jsx)(n.td,{style:{textAlign:"left"},children:"no"}),(0,l.jsx)(n.td,{style:{textAlign:"left"},children:(0,l.jsx)(n.code,{children:"[]"})})]})]})]}),"\n",(0,l.jsx)(n.h3,{id:"if_datapoint_value",children:(0,l.jsx)(n.code,{children:"$IF_DATAPOINT_VALUE$"})}),"\n",(0,l.jsxs)(n.p,{children:["Renders the provided ",(0,l.jsx)(n.code,{children:"mapping"})," template if the value of the given ",(0,l.jsx)(n.code,{children:"schema_id"})," is equal to ",(0,l.jsx)(n.code,{children:"value"}),". Otherwise, the whole parent key is skipped."]}),"\n",(0,l.jsxs)(n.p,{children:["Note that if element with given ",(0,l.jsx)(n.code,{children:"schema_id"})," is not found or multiple with the same ",(0,l.jsx)(n.code,{children:"schema_id"})," is found an exception is raised."]}),"\n",(0,l.jsx)(n.h4,{id:"example-2",children:"Example"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json",children:'{\n  "Other_Field": 123,\n  "Company_Reference": {\n    "$IF_DATAPOINT_VALUE": {\n      "schema_id": "company_match",\n      "value": "my_company",\n      "mapping": {\n        "field_1": 456,\n        "field_2": 789\n      }\n    }\n  }\n}\n'})}),"\n",(0,l.jsxs)(n.p,{children:["If ",(0,l.jsx)(n.code,{children:"company_match"})," has value ",(0,l.jsx)(n.code,{children:"my_company"})," the output will be:"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json",children:'{\n  "Other_Field": 123,\n  "Company_Reference": {\n    "field_1": 456,\n    "field_2": 789\n  }\n}\n'})}),"\n",(0,l.jsxs)(n.p,{children:["If ",(0,l.jsx)(n.code,{children:"company_match"})," has value that is different from ",(0,l.jsx)(n.code,{children:"my_company"})," the output will be:"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json",children:'{\n  "Other_Field": 123\n}\n'})}),"\n",(0,l.jsx)(n.h4,{id:"available-configuration-options-3",children:"Available configuration options"}),"\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{style:{textAlign:"left"},children:"Configuration option"}),(0,l.jsx)(n.th,{style:{textAlign:"left"},children:"Description"}),(0,l.jsx)(n.th,{style:{textAlign:"left"},children:"Required"}),(0,l.jsx)(n.th,{style:{textAlign:"left"},children:"Default"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{style:{textAlign:"left"},children:(0,l.jsx)(n.code,{children:"schema_id"})}),(0,l.jsx)(n.td,{style:{textAlign:"left"},children:"Schema ID of the relevant datapoint."}),(0,l.jsx)(n.td,{style:{textAlign:"left"},children:"YES"}),(0,l.jsx)(n.td,{style:{textAlign:"left"}})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{style:{textAlign:"left"},children:(0,l.jsx)(n.code,{children:"value"})}),(0,l.jsxs)(n.td,{style:{textAlign:"left"},children:["Conditional (expected) value in ",(0,l.jsx)(n.code,{children:"schema_id"}),"."]}),(0,l.jsx)(n.td,{style:{textAlign:"left"},children:"YES"}),(0,l.jsx)(n.td,{style:{textAlign:"left"}})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{style:{textAlign:"left"},children:(0,l.jsx)(n.code,{children:"fallback_mapping"})}),(0,l.jsxs)(n.td,{style:{textAlign:"left"},children:["Mapping template that will be rendered if ",(0,l.jsx)(n.code,{children:"schema_id"})," contains ",(0,l.jsx)(n.code,{children:"value"}),"."]}),(0,l.jsx)(n.td,{style:{textAlign:"left"},children:"YES"}),(0,l.jsx)(n.td,{style:{textAlign:"left"}})]})]})]}),"\n",(0,l.jsx)(n.h3,{id:"if_schema_id",children:(0,l.jsx)(n.code,{children:"$IF_SCHEMA_ID$"})}),"\n",(0,l.jsxs)(n.p,{children:["Similar to ",(0,l.jsx)(n.a,{href:"#for_each_schema_id",children:(0,l.jsx)(n.code,{children:"$FOR_EACH_SCHEMA_ID$"})})," operation: it checks the existence of ",(0,l.jsx)(n.code,{children:"schema_id"}),", and it either outputs ",(0,l.jsx)(n.code,{children:"mapping"})," if the ",(0,l.jsx)(n.code,{children:"schema_id"})," points to a non-empty value or ",(0,l.jsx)(n.code,{children:"fallback_mapping"})," otherwise."]}),"\n",(0,l.jsxs)(n.p,{children:["Note that if you don't specify the ",(0,l.jsx)(n.code,{children:"fallback_mapping"}),", it will skip the whole parent key!"]}),"\n",(0,l.jsx)(n.h4,{id:"example-3",children:"Example"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json",children:'{\n  "dueDate": {\n    "$IF_SCHEMA_ID$": {\n      "schema_id": "date_due",\n      "mapping": {\n        "$DATAPOINT_VALUE$": {\n          "schema_id": "date_due",\n          "value_type": "iso_datetime"\n        }\n      }\n    }\n  }\n}\n'})}),"\n",(0,l.jsx)(n.h4,{id:"available-configuration-options-4",children:"Available configuration options"}),"\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{style:{textAlign:"left"},children:"Configuration option"}),(0,l.jsx)(n.th,{style:{textAlign:"left"},children:"Description"}),(0,l.jsx)(n.th,{style:{textAlign:"left"},children:"Required"}),(0,l.jsx)(n.th,{style:{textAlign:"left"},children:"Default"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{style:{textAlign:"left"},children:(0,l.jsx)(n.code,{children:"schema_id"})}),(0,l.jsx)(n.td,{style:{textAlign:"left"},children:"Schema ID of the datapoint."}),(0,l.jsx)(n.td,{style:{textAlign:"left"},children:"YES"}),(0,l.jsx)(n.td,{style:{textAlign:"left"}})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{style:{textAlign:"left"},children:(0,l.jsx)(n.code,{children:"mapping"})}),(0,l.jsxs)(n.td,{style:{textAlign:"left"},children:["Mapping template that will be rendered if ",(0,l.jsx)(n.code,{children:"schema_id"})," exists."]}),(0,l.jsx)(n.td,{style:{textAlign:"left"},children:"YES"}),(0,l.jsx)(n.td,{style:{textAlign:"left"}})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{style:{textAlign:"left"},children:(0,l.jsx)(n.code,{children:"fallback_mapping"})}),(0,l.jsxs)(n.td,{style:{textAlign:"left"},children:["Mapping template that will be rendered if no element with the given ",(0,l.jsx)(n.code,{children:"schema_id"})," is found. Note that if you don't specify the ",(0,l.jsx)(n.code,{children:"fallback_mapping"}),", it will skip the whole parent key!"]}),(0,l.jsx)(n.td,{style:{textAlign:"left"},children:"no"}),(0,l.jsx)(n.td,{style:{textAlign:"left"}})]})]})]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(o,{...e})}):o(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>d,x:()=>a});var l=t(6540);const i={},s=l.createContext(i);function d(e){const n=l.useContext(s);return l.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:d(e.components),l.createElement(s.Provider,{value:n},e.children)}}}]);